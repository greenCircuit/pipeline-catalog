.check-helm:
  stage: unit-test
  image: registry.dev.local/homelab/pipeline-catalog/k8s:latest
  variables:
    CHECK_PATH: ""
  script: | #shell
    echo "CHECK_PATH:        ${CHECK_PATH}"
    echo "inside chart dir"
    ls ${CHECK_PATH}
    cd $CHECK_PATH
    helm template . > generated.yaml
    echo helm been generated correctly
    cat generated.yaml
    /kubeconform -summary -output json --skip generated.yaml > "report.json"
    echo "=============="
    cat report.json
  artifacts:
    paths:
      - ${CHECK_PATH}/report.json
      - ${CHECK_PATH}/generated.yam
    expire_in: 1 week
