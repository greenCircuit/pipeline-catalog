.check-helm:
  stage: unit-test
  image: registry.dev.local/homelab/pipeline-catalog/k8s:latest
  variables:
    CHECK_PATH: ""
  script: | #shell
    echo "CHECK_PATH:        ${CHECK_PATH}"
    echo "inside chart dir"
    ls ${CHECK_PATH}
    cd $CHECK_PATH
    helm template --debug . > generated.yaml
    helm plugin list
    helm plugin install https://github.com/jtyr/kubeconform-helm
    helm kubeconform --verbose --summary .

    # /kubeconform -summary -output json --skip CustomResourceDefinition generated.yaml > "report.json" || true
    echo "=============="
    cat report.json
  artifacts:
    paths:
      - ${CHECK_PATH}/report.json
      - ${CHECK_PATH}/generated.yam
    expire_in: 1 week
