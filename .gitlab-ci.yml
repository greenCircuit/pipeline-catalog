include:
  - pipelines/stages.yaml
  - pipelines/podman.yaml
  - pipelines/security.yaml
  - pipelines/template.yml
  - pipelines/release.yaml

# running all pipelines in order to validate them

# podman:
#   extends: .create_image

git-leaks:
  extends: .secrets_scan

semver:
  extends: .make-semver

check-semver:
  needs: [semver]
  image: registry.dev.local/homelab/pipeline-catalog:latest
  stage: semver 
  script: | # shell
    env | grep SEMVER
    env | grep MAKE_RELEASE
    if [[ $SEMVER == "" || $MAKE_RELEASE == "" ]]; then
      echo semver job didnt provide env variables
    fi
    echo semver creation job was correct


create-changelog:
  extends: .changelog
  variables:
    version: "${SEMVER}"
  rules:
  - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'

tag-repo:
  extends: .create-tag
  variables:
    version: "${SEMVER}"
  rules:
  - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
