variables:
  SEMVER: "0.0.1"   # updated by semver job
  
include:
  - pipelines/stages.yaml
  - pipelines/podman.yaml
  - pipelines/security.yaml
  - pipelines/template.yml
  - pipelines/release.yaml

# running all pipelines in order to validate them

# podman:
#   extends: .create_image

git-leaks:
  extends: .secrets_scan

semver:
  extends: .make-semver

check-semver:
  image: registry.dev.local/homelab/pipeline-catalog:latest
  stage: release 
  script: |
    env | grep SEMVER

create-changelog:
  extends: .changelog
  variables:
    version: "${SEMVER}"
  rules:
  - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'

tag-repo:
  extends: .create-tag
  variables:
    version: "${SEMVER}"
  # rules:
  # - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
